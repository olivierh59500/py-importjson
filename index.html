<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Py-importjson by TonyFlury</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Py-importjson</h1>
        <p class="header">Import json data into python as a module, complete with auto creation of classes, class and instance data attributes, __init__ methods and more.</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/TonyFlury/py-importjson/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/TonyFlury/py-importjson/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/TonyFlury/py-importjson">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/TonyFlury">TonyFlury</a></p>


      </header>
      <section>
        <h1></h1>

<h1>
<a id="importjson--import-json-data-into-a-python-application" class="anchor" href="#importjson--import-json-data-into-a-python-application" aria-hidden="true"><span class="octicon octicon-link"></span></a>importjson : Import json data into a python application</h1>

<p>It is sometimes useful to be able to use json data to initialise classes and other data structures, giving your application a portable and human readable configuration capability. To do this you will probably write some level of functionality around the json standard library, and use the resulting data loaded from the json file, to populate classes and instances implemented in your application. This separates your data and functionality, which can often present challenges later down the line as you need to keep the data and functionality in step.</p>
<p>It would be better in many cases to be able to combine the data and functionality in a single place, and with the importjson library you can do that. The library allows you to import a json file direct into your python application.
The library uses the json data to construct a set of classes, complete with class attributes, and instance data attributes (implemented with set and get descriptors). These classes are presented as a fully formed python module - just as if you had written the code yourself.</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><em>Bugs</em></th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Every care is taken to try to ensure that this code comes to you bug free.
If you do find an error - please report the problem on :
<a class="reference external" href="https://github.com/TonyFlury/py-importjson/issues/new">GitHub</a>
or
by email to : <a class="reference external" href="mailto:anthony.flury?Subject=ImportJson%20Error">Tony Flury</a></td>
</tr>
</tbody>
</table>
<div class="section" id="example">
<h1>Example</h1>
<p>The json file called <cite>classes.json</cite> exists in your applications current directory</p>
<pre class="code json literal-block">
<span class="p">{</span>
    <span class="nt">&quot;__version__&quot;</span><span class="p">:</span><span class="s2">&quot;0.1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;__author__&quot;</span><span class="p">:</span><span class="s2">&quot;Tony&quot;</span><span class="p">,</span>
    <span class="nt">&quot;point&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;__doc__&quot;</span><span class="p">:</span> <span class="s2">&quot;Example class built from json&quot;</span><span class="p">,</span>
        <span class="nt">&quot;__class_attributes__&quot;</span><span class="p">:</span> <span class="p">{</span>
                          <span class="nt">&quot;_val1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="nt">&quot;_val2&quot;</span><span class="p">:</span> <span class="mi">2</span>
                        <span class="p">},</span>
        <span class="nt">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nt">&quot;y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nt">&quot;colour&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
         <span class="p">}</span>
<span class="p">}</span>
</pre>
<p>Even with the json standard library only, it might take 10 lines or so to bring that json data into your application,
and to populate instances of your classes.</p>
<p>With the <cite>importjson</cite> library you can import this json directly into your application, and create the classes with 2
lines as demonstrated here in the console</p>
<pre class="code python literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">importjson</span> <span class="c"># Importjson library - must be imported before any json files</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">classes</span>          <span class="c"># Will import classes.json</span>
</pre>
<p>The contents of the 'classes.json` file have now been translated into module attributes and classes, which can be used just as any other module or class. All the values defined in the json file have been translated into module attributes, classes, class attributes, or data attributes as appropriate (see Details section below for the expected json structure):</p>
<pre class="code python literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="c"># Module attributes</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">classes</span><span class="o">.</span><span class="n">__author__</span><span class="p">,</span> <span class="n">classes</span><span class="o">.</span><span class="n">__version__</span>
<span class="s">u'Tony'</span><span class="p">,</span> <span class="s">u'0.1'</span>
</pre>
<p>As per the json implementation in the python standard library, all strings are treated as unicode.</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><strong>Warning</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Because of the way that python implements imports - having classes.json and classes.py in the same directory or
package the classes.json will be imported and the classes.py file will be effectively hidden, and cannot be
imported. This will cause unexpected behaviour unless you are careful about your file naming.</td>
</tr>
</tbody>
</table>
<p>By default the module has a auto generated documentation string</p>
<pre class="code python literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">classes</span><span class="o">.</span><span class="n">__doc__</span>
<span class="n">Module</span> <span class="n">classes</span> <span class="o">-</span> <span class="n">Created</span> <span class="n">by</span> <span class="n">JSONLoader</span>
   <span class="n">Original</span> <span class="n">json</span> <span class="n">data</span> <span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">tony</span><span class="o">/</span><span class="n">Development</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">importjson</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">classes</span><span class="o">.</span><span class="n">json</span>
   <span class="n">Generated</span> <span class="n">Mon</span> <span class="mi">12</span> <span class="n">Oct</span> <span class="mi">2015</span> <span class="mi">22</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">54</span> <span class="n">BST</span> <span class="p">(</span><span class="n">UTC</span> <span class="o">+</span><span class="mo">0100</span><span class="p">)</span>
</pre>
<p>The <tt class="docutils literal">__classes__</tt> dictionary in the json file has been converted to one or more classes (in this example the 'point' class) - see the Details section part 3 &amp; 4 for particulars</p>
<pre class="code python literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="nb">dir</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
<span class="p">[</span><span class="s">'__builtins__'</span><span class="p">,</span> <span class="s">'__doc__'</span><span class="p">,</span> <span class="s">'__file__'</span><span class="p">,</span> <span class="s">'__json__'</span><span class="p">,</span> <span class="s">'__loader__'</span><span class="p">,</span> <span class="s">'__name__'</span><span class="p">,</span> <span class="s">'__package__'</span><span class="p">,</span> <span class="s">'__version__'</span><span class="p">,</span> <span class="s">'__author__'</span><span class="p">,</span><span class="s">'point'</span><span class="p">]</span>
</pre>
<p>The classes which are created have all the properties you might expect - for instance as defined by the <tt class="docutils literal">__doc__</tt> and the <tt class="docutils literal">__class__attributes__</tt> dictionary in  the json file we can define class data attributes - see Details section 5</p>
<p><strong>Note</strong> : Special module variables :
From the <tt class="docutils literal">dir</tt> listing above you will see a number of special module variables :</p>
<blockquote>
<ul class="simple">
<li><tt class="docutils literal">__builtins__</tt> : as per all modules this is the standard python builtins modules</li>
<li><tt class="docutils literal">__doc__</tt> : as demonstrated above this is the module documentation string (either the auto generated or defined in the json file.</li>
<li><tt class="docutils literal">__file__</tt> : this is the full path to the json file</li>
<li><tt class="docutils literal">__json__</tt> : the original json file imported as a dictionary. It is included for interest only, it should not ever be necessary to use the data in this dictionary (as it has all been converted to the specific module data attributes, classes and other content.</li>
<li><tt class="docutils literal">__loader__</tt> : This is the custom loader object (which the importjson library implements).</li>
<li><tt class="docutils literal">__name__</tt> : As with all other modules - this is the fully qualified module name.</li>
<li><tt class="docutils literal">__package__</tt> : This is False, as the json file cannot ever define a package</li>
</ul>
</blockquote>
<p>The <tt class="docutils literal">__version__</tt> and <tt class="docutils literal">__author__</tt> variables are not special variables - as they are defined by the json file.</p>
<pre class="code python literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">classes</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">_val1</span>
<span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">classes</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">_val2</span>
<span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">classes</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">__doc__</span>
<span class="s">'Example class built from json'</span>
</pre>
<p>Instances which are created from these classes have the expected Instance data attributes with default values derived from the relevant entries in the json. Instance Data Attributes can be retrieved by name (as expected).</p>
<pre class="code python literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">inst</span> <span class="o">=</span> <span class="n">classes</span><span class="o">.</span><span class="n">point</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">inst</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">inst</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">inst</span><span class="o">.</span><span class="n">colour</span>
<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre>
<p>The class is generated with a initializer (<tt class="docutils literal">__init__</tt> method) which accepts arguments so the default can be overridden. These arguments are in the same order as the json file.</p>
<pre class="code python literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">insta</span> <span class="o">=</span> <span class="n">classes</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">insta</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">insta</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">insta</span><span class="o">.</span><span class="n">colour</span>
<span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre>
<p>Arguments to the initializer can be keyword arguments too - using the same names in the json file.</p>
<pre class="code python literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">instb</span> <span class="o">=</span> <span class="n">classes</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">instb</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">instb</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">instb</span><span class="o">.</span><span class="n">colour</span>
<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre>
<p>Instance Data attributes can be changed using the normal dot syntax :</p>
<pre class="code python literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="n">insta</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">23</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">insta</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">insta</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">insta</span><span class="o">.</span><span class="n">colour</span>
<span class="mi">23</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</pre>
</div>
<div class="section" id="constraints">
<h1>Constraints</h1>
<p>It is possible to define constraint criteria for the Instance Data Attributes, by using a <tt class="docutils literal">__constraints__</tt> sub
dictionary within the class definition - as an example :</p>
<pre class="code json literal-block">
<span class="p">{</span>
    <span class="nt">&quot;point&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nt">&quot;y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nt">&quot;__constraints__&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;x&quot;</span><span class="p">:{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
                <span class="nt">&quot;min&quot;</span><span class="p">:</span><span class="mi">-100</span><span class="p">,</span>
                <span class="nt">&quot;max&quot;</span><span class="p">:</span><span class="mi">100</span>
                <span class="p">}</span>
            <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
<p>This would implement a definition of the <tt class="docutils literal">x</tt> attribute on instances of the <tt class="docutils literal">point</tt> class could only ever be set to
an integer (or boolean), and must between -100 and 100 inclusive. The allowed criteria are <tt class="docutils literal">type</tt>, <tt class="docutils literal">min</tt>, <tt class="docutils literal">max</tt>, <tt class="docutils literal">read_only</tt> and <tt class="docutils literal">not_none</tt>.
The``type`` can be any one of <tt class="docutils literal">list</tt>, <tt class="docutils literal">str</tt>, <tt class="docutils literal">int</tt>, <tt class="docutils literal">float</tt>, <tt class="docutils literal">dict</tt> or <tt class="docutils literal">bool</tt> or the name of a class which is also defined in the JSOn file.</p>
<blockquote>
<ul class="simple">
<li>A <tt class="docutils literal">type</tt> of <tt class="docutils literal">float</tt> will allow both floats and integer values</li>
<li>A <tt class="docutils literal">type</tt> of <tt class="docutils literal">int</tt> will allow both integers and booleans values</li>
<li>A <tt class="docutils literal">type</tt> of <tt class="docutils literal">bool</tt> will only allow either True or False values</li>
<li>If an attempt is made to set an attribute to a value outside the range defined by <tt class="docutils literal">min</tt> and <tt class="docutils literal">max</tt> the <tt class="docutils literal">ValueError</tt> exception will be raised.</li>
<li>If an attempt is made to set an attribute to None when <tt class="docutils literal">not_none</tt> is set to True, a <tt class="docutils literal">ValueError</tt> exception will be raised. The value defaults to False if omitted - i.e. atributes can be set to None.</li>
<li>If an attempt is made to set an attribute to a value which does not match the type criteria, then a <tt class="docutils literal">TypeError</tt> exception will be raised.</li>
</ul>
</blockquote>
<ul class="simple">
<li>If an attempt is made to set an attribute when <tt class="docutils literal">read_only</tt> is set to True, a <tt class="docutils literal">ValueError</tt> exception will be raised. This does not include setting the attribute in the initialiser/constructor.</li>
</ul>
<blockquote>
<ul class="simple">
<li>All criteria are optional - but an empty or missing constraints section has no effect.</li>
</ul>
</blockquote>
<p>See Section 6 below for details of the Constrains system and how to extend it by subclassing.</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><strong>Warning</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr><td>You must ensure that the default value given for the data attribute is valid based on any constraints defined for
that attribute. If the default value is invalid, then the JSON will import successfully, but the class will not be
able to be created with it's default values.</td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<p><em>Note</em> : From v0.0.1a5 onwards the example JSON used at the top of this README could be changed to be as follows :</p>
<pre class="code json literal-block">
<span class="p">{</span>
    <span class="nt">&quot;__version__&quot;</span><span class="p">:</span><span class="s2">&quot;0.1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;__author__&quot;</span><span class="p">:</span><span class="s2">&quot;Tony&quot;</span><span class="p">,</span>
    <span class="nt">&quot;__classes__&quot;</span><span class="p">:{</span>
        <span class="nt">&quot;point&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;__doc__&quot;</span><span class="p">:</span> <span class="s2">&quot;Example class built from json&quot;</span><span class="p">,</span>
            <span class="nt">&quot;__class_attributes__&quot;</span><span class="p">:</span> <span class="p">{</span>
                              <span class="nt">&quot;_val1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                              <span class="nt">&quot;_val2&quot;</span><span class="p">:</span> <span class="mi">2</span>
                            <span class="p">},</span>
            <span class="nt">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;colour&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
<p>Note the existence of the &quot;__classes__&quot; dictionary. This form is termed as the explicit form. The advantage of this form is that it is possible to define Module Data Attributes which are dictionaries, something which impossible in the other form of json.</p>
<hr class="docutils" />
<div class="section" id="details">
<h2>Details</h2>
</div>
</div>
<div class="section" id="module-configuration">
<h1>0 Module Configuration</h1>
<p>The importjson module supports one configuration options, set using <tt class="docutils literal"><span class="pre">importjson.configure(&lt;config_item&gt;,&lt;value&gt;)</span></tt>. The config_items supported are :</p>
<ul class="simple">
<li><tt class="docutils literal">JSONSuffixes</tt> : A list of valid JSON file name suffixes which are used when searching for potential JSON files to import. The default is [&quot;.json&quot;]. Setting this value incorrectly will prevent the library from finding or importing any JSON files - so take care.</li>
</ul>
<p>A previous configuration item <tt class="docutils literal">AllDictionariesAsClasses</tt> has been rendered obsolete due to changes in <tt class="docutils literal">0.0.1a5</tt> and a exception is raised if this item is attempted to be used.</p>
</div>
<div class="section" id="json-file-structure">
<h1>1 JSON file structure</h1>
<p>The json file must be in a specific format :</p>
<p>The Top level of the json file <strong>must</strong> be a directory.</p>
</div>
<div class="section" id="top-level-content">
<h1>2 Top Level content</h1>
<dl class="docutils">
<dt><strong>All</strong> key, value pairs in the top level are created as module level attributes (see example of <tt class="docutils literal">__version__</tt> above) with the following notes and exceptions:</dt>
<dd><ul class="first last simple">
<li>An optional key of <tt class="docutils literal">__doc__</tt> is found then the value is used as the module documentation string instead of an automatically generated string. While it is normal that the value is a string if a different object is provided the documentation string will be set to the string representation of that object.</li>
<li>If an optional key of <tt class="docutils literal">__classes__</tt> exists then this dictionary is interpreted as the definition of the classes in this module - see section 3. Any in this case any other dictionary under the Top Level JSON is treated as a Module Data Attribute.</li>
<li>If an optional key of <tt class="docutils literal">__classes__</tt> does not exists then all dictionaries under the Top Level areas the definition of the classes in this module - see section 4. Any in this case it is not possible to define a Module Data Attribute with a dictionary value.</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="content-of-classes-dictionary">
<h1>3 Content of <tt class="docutils literal">__classes__</tt> dictionary</h1>
<p>When the <tt class="docutils literal">__classes__</tt> dictionary exists in the json file, each key,value within that dictionary is a separate class to be created. The key is the class name, and the value must be a dictionary (called the class defining dictionary) - see section 4. An example of this form of JSON file is used above.</p>
</div>
<div class="section" id="content-of-a-class-defining-dictionary">
<h1>4 Content of a class defining dictionary</h1>
<dl class="docutils">
<dt>Within the class defining dictionary, each key,value pair is used as instance attributes; the value in the json file is used as the default value for that attribute, and is set as such in the initializer method for the class. This is true for all key,value pairs with the following notes and exceptions:</dt>
<dd><ul class="first last simple">
<li>An optional key of <tt class="docutils literal">__doc__</tt> will set the documentation string for the class - unlike at module level there is no automatically generated documentation string for the class. While it is normal that the value is a string if a different object is provided the documentation string will be set to the string representation of that object</li>
<li>An optional key of <tt class="docutils literal">__class_attributes__</tt> will have the value which is a dictionary : This dictionary defines the names and values of the class data attributes (as opposed to the instance data attributes) - see section 5</li>
<li>An optional key of <tt class="docutils literal">__parent__</tt> will have a string value which is used as the name of a superclass for this class.</li>
<li>An optional key <tt class="docutils literal">__constraints__</tt> which will have a dictionary value - and define constraint to be applied to the value of individual Instance Data Attributes - see section 6</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="content-of-the-class-attributes-dictionary">
<h1>5 Content of the <tt class="docutils literal">__class_attributes__</tt> dictionary</h1>
<p>Within the <tt class="docutils literal">__class_attributes__</tt> dictionary each key, value pair defines the name and value of a class data attribute. There are no exceptions to this rule.</p>
</div>
<div class="section" id="content-of-the-constraints-dictionary">
<h1>6 Content of the <tt class="docutils literal">__constraints__</tt> dictionary</h1>
<p>Within the <tt class="docutils literal">__constraints__</tt> dictionary each key is the the name Instance Data attribute, as defined within the class defining dictionary. It is not neccessary for every Instance Data Attribute to be represented by a key in the <tt class="docutils literal">__constraints__</tt> dictionary.</p>
<p>Each key has the value of a dictionary, and this dictionary has zero or more keys within it (every key being optional) :</p>
<ul class="simple">
<li><tt class="docutils literal">type</tt> : Can be used to constrain the type of value allowed for the attribute
- <tt class="docutils literal">list</tt> : constrains the type to be a list (the values of the items are not restricted)
- <tt class="docutils literal">str</tt> : constrains the type to be a string or basestring
- <tt class="docutils literal">int</tt>  : constrains the type to be a integer or boolean
- <tt class="docutils literal">float</tt>  : constrains the type to be a float or integer
- <tt class="docutils literal">dict</tt>  : constrains the type to be a dictionary (keys and values are not restricted)
- <tt class="docutils literal">bool</tt> : constrains the type to be boolean (i.e. True or False Only)
- Any other value must be the name of a class defined in the JSON file - although this is not checked at import time.</li>
<li><tt class="docutils literal">min</tt> : Constrain the minimum value allowed for the attribute - applied to strings and numeric values only</li>
<li><tt class="docutils literal">max</tt> : Constrain the maximum value allowed for the attribute - applied to strings and numeric values only</li>
<li><tt class="docutils literal">not_none</tt> : determines if the value is allowed to be a None value</li>
<li><tt class="docutils literal">read_only</tt> : determine if the value can be changed after the instance is created</li>
</ul>
<p>If an attempt is made to set an attribute to a value outside the range defined by <tt class="docutils literal">min</tt> and <tt class="docutils literal">max</tt> the <tt class="docutils literal">ValueError</tt> exception will be raised. This include setting the value within the Instance initializer.</p>
<p>If an attempt is made to set an attribute to a value which does not match the type criteria, then a <tt class="docutils literal">TypeError</tt> exception will be raised. This includes setting the value within the Instance initializer.</p>
<p>If an attempt is made to set an attribute to None when <tt class="docutils literal">not_none</tt> is set to True, a <tt class="docutils literal">ValueError</tt> exception will be raised. This value defaults to false - i.e. None values are allowed.</p>
<ul class="simple">
<li>If an attempt is made to set an attribute when <tt class="docutils literal">read_only</tt> is set to True, a <tt class="docutils literal">ValueError</tt> exception will be raised. This does not include setting the attribute in the initialiser/constructor. This value defaults to False, i.e. attributes can be changed at any time.</li>
</ul>
<p>All criteria are optional - an empty or missing constraints section for a given attribute has no effect.</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><strong>Warning</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Since the constraints are applied every time the value is set, including the initializer, you must
ensure that the default value given for the data attribute is valid based on any constraints defined
for that attribute. If the default value is invalid, then the JSON will import successfully, but the
class will not be able to be created with it's default values.</td>
</tr>
<tr><td>The values in the constraints section are not cross checked currently at the time of import, and
any errors (such as incorrect numeric ranges or invalid types) will only be detectable when
instances are created. It is relatively simple though to change the json file and reload the module</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="extending-constraints">
<h1>Extending constraints</h1>
<p>The constraints system has been constructed to allow simple extensions. By subclassing the class, and creating a method called <tt class="docutils literal">_constrain_&lt;attr_name&gt;</tt> you can add further tests to the constraints applied to the named attribute. As an example</p>
<pre class="code python literal-block">
<span class="kn">import</span> <span class="nn">importjson</span>
<span class="kn">import</span> <span class="nn">json_classes</span> <span class="c"># Defines the `classa` class which has Data Instance attribute x</span>

<span class="k">class</span> <span class="nc">XMustBeEven</span><span class="p">(</span><span class="n">json_classes</span><span class="o">.</span><span class="n">classa</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_constrain_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">XMustBeEven</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_constrain_x</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Value Error : x must be an even number&quot;</span><span class="p">)</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">XMustBeEven</span><span class="p">()</span>
<span class="n">e</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span> <span class="c"># will be fine - no exceptions expected</span>
<span class="n">e</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">Value</span> <span class="n">Error</span> <span class="p">:</span> <span class="n">x</span> <span class="n">must</span> <span class="n">be</span> <span class="n">an</span> <span class="n">even</span> <span class="n">number</span>
</pre>
<p>The <tt class="docutils literal">_constrain_&lt;attr_name&gt;</tt> method takes the <tt class="docutils literal">value</tt> as an argument (this is the attempted new value, not the current value, and must
either return a value (which will be stored as the value of the attribute, or must raise an Exception (ValueError and TypeError are the norms)</p>
<p>As shown in the example any extension should call the <tt class="docutils literal">&lt;super class&gt; _constrain</tt> method first, as it is that method which applies all of the constrains defined in the JSON file - including any type checks. By allowing the superclass method to execute first, you can be sure that the value returned is the expected type (assuming that the JSON file constrains the type).</p>
<hr class="docutils" />
<div class="section" id="notes-and-comments">
<h2>Notes and Comments</h2>
<ol class="arabic simple">
<li>Instance data attributes are actually created with the name prefixed by a <tt class="docutils literal">_</tt>, thus marking the attribute as private. A read/write descriptor is then created with the name as given in the json file.</li>
<li>If the json defines Instance data attribute with a default value which is a mutable type (list or dictionary), the initializer ensures that changes to the instance are not propagated to other instances. See <a class="reference external" href="http://docs.python-guide.org/en/latest/writing/gotchas/">Common Python Gotchas</a> for a description of this issue. There are no plans to allow this protection to be turned off.</li>
<li>All strings are imported as Unicode - as can be seen from the <tt class="docutils literal">__version__</tt> example above.</li>
<li>The module works by creating a python code block which is then compiled into the module and made available to the application. That code block is available for information : <tt class="docutils literal"><span class="pre">&lt;module&gt;.__loader__.get_source(&lt;module_name)</span></tt> - while the json file is available through the <tt class="docutils literal">__file__</tt> module attribute, and the imported dictionary can be seen by inspecting <tt class="docutils literal">__json__</tt> module attribute. Under normal circumstance it should not be necessary to use either the json dictionary or the generated code.</li>
</ol>
</div>
<div class="section" id="shortcomings">
<h2>Shortcomings</h2>
<ol class="arabic simple">
<li>It is not possible to use json to define tuples, sets or other complex python data types. json only supports strings, lists, numbers and dictionaries. This is not a limitation of the importjson library, and cannot be fixed easily.</li>
<li>All instance data attributes are read/write, read_only is not possible in this implementation - see Futures</li>
<li>It is not possible to set a documentation string for any of the instance data attributes - see Futures</li>
<li>Keys in the <tt class="docutils literal">__constraints__</tt> section of each class are lower case only.</li>
</ol>
</div>
<div class="section" id="future">
<h2>Future</h2>
<dl class="docutils">
<dt>Possible future enhancements :</dt>
<dd><ul class="first last simple">
<li>Read only instance data attributes</li>
<li>Auto generation of factory methods, using a specific attribute as the key</li>
<li>Auto generation of human friendly <tt class="docutils literal">__str__</tt> and <tt class="docutils literal">__repr__</tt> functions</li>
<li>Documentation strings for the Instance Data Attributes</li>
<li>Allow Data Instance Attributes to have a non builtin type.</li>
<li>Keys in <tt class="docutils literal">__constrains__</tt> section should be case insensitive</li>
<li>validity of <tt class="docutils literal">__constrains_</tt> items should be performed at import time.</li>
</ul>
</dd>
</dl>
</div>
</div>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
